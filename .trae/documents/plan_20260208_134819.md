# QuarkPanTool Feature 7 Implementation Plan (Revised)

## 1. Requirements Analysis
The goal is to add a "One-click Download" feature (Feature 7) and enhance CLI support for automation.

### Functional Requirements
1.  **Workflow (Feature 7)**:
    *   **Step 1 (Save)**: Save content from an external share URL to the user's Quark Pan.
    *   **Step 2 (Share)**: Batch generate share links for the saved content.
    *   **Step 3 (Download)**: Download files locally using the generated links.
2.  **Configuration Defaults**:
    *   **Traverse Depth**: 1 (Share first-level directories).
    *   **Share Link Validity**: 1 day.
    *   **Share Password**: None.
3.  **Automation (CLI)**:
    *   Support command: `python quark.py --save <id> --download <url>`
    *   `--save <id>`: Optional. Sets the save directory ID. Default: `0` (Root).
    *   `--download <url>`: Optional. If provided, triggers the One-click Download feature. If omitted, starts the standard interactive menu.

## 2. Technical Design

### 2.1 CLI Argument Parsing
*   Use `argparse` to handle arguments:
    *   `--save`: Store as `save_dir_id`.
    *   `--download`: Store as `download_url`.
*   **Logic**:
    *   If `download_url` is provided:
        *   Initialize `QuarkPanFileManager`.
        *   Override `pdir_id` with `save_dir_id` (if provided) or use config/default '0'.
        *   Execute `one_click_download_pipeline(download_url)`.
        *   Exit.
    *   Else:
        *   Proceed to standard interactive menu.

### 2.2 Code Refactoring (`quark.py`)
*   **`QuarkPanFileManager.share_run`**:
    *   Modify to accept `fid` directly to support sharing a specific directory ID without a URL.
*   **`QuarkPanFileManager` Initialization**:
    *   Ensure `pdir_id` can be set/overridden effectively for the automation session.

### 2.3 New Logic Implementation
*   **`QuarkPanFileManager.one_click_download_pipeline(self, share_url)`**:
    *   **Step 1**: `self.run(share_url, self.pdir_id, download=False)` (Save).
    *   **Step 2**: `self.share_run(..., fid=self.pdir_id, traverse_depth=1, expired_type=2, url_type=1)` (Share).
    *   **Step 3**: Parse `share/share_url.txt` and loop `self.run(url, ..., download=True)` (Download).

### 2.4 User Interface
*   Add "7. One-click Download" to the interactive menu.
*   Implement option 7 logic to prompt for URL and call the pipeline.

## 3. Implementation Steps
1.  **Import `argparse`**.
2.  **Implement `one_click_download_pipeline`**.
3.  **Refactor `share_run`**.
4.  **Implement CLI Parsing** at the start of `__main__`.
5.  **Update Menu** and interactive loop.
6.  **Verify** logic flow.
